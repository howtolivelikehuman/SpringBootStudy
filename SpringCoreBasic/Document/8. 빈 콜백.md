## 8. 빈 생명주기 콜백

스프링 빈이 생성/죽기 직전에 메소드 호출하는 방법

DB 커넥션 풀, 네트워크 소켓 같은 것들은 어플리케이션 서버와 시작할때 미리 연결해 놓고 종료 시점에 연결을 모두 종료하는 작업을 진행하고 싶음 ->  초기화-종료 작업이 필요함



하지만 초기화는 의존관계 주입이 모두 완료되고 난 다음에 호출해야 함 -> 이걸 어떻게 알까? = 콜백 메소드

스프링 빈의 이벤트 라이프사이클

> 스프링 컨테이너 생성 -> 빈 생성 -> 의존관계 주입 -> 초기화 콜백 -> 사용 -> 소멸 전 콜백 -> 종료



Q. 그냥 생성자에서 다 하는게 낫지 않냐?

A. 객체의 생성과 초기화를 분리하는게 좋음. 

생성은 말 그대로 필수값들로 생성하는데 집중해야 함.

초기화는 동작과 관련(커넥션 만들기 등) -> 무거움 -> 둘을 나누는게 유지보수 관점에서 좋음

객체를 생성 -> 최초의 행위가 올 때 까지 커넥션 지연하다 -> 액션이 오면 그때 초기화 (연결) 하는 방법도 가능.



#### 인터페이스(InitializingBean, DisposableBean)

implements InitializingBean,  DisposableBean

-> afterPropertiesSet(), destroy() 으로 초기화, 소멸에 사용



[단점]

1. 스프링 전용 인터페이스
2. 초기화, 소멸 메소드 이름 변경 가능
3. 코드를 내가 못 고치는 외부 라이브러리에는 적용할 수 없음

-> 초창기 방법이고, 지금은 사용하지 않음



#### 빈 등록 초기화, 소멸 메소드 지정

@Bean(initMethod = "init", destroyMethod = "close") 이런식으로 등록



[장점]

1. 메서드 이름 자유롭게 사용 가능
2. 스프링 빈이 스프링 코드에 의존하지 않음
3. 설정 정보를 사용 -> 코드 못고치는 외부 라이브러리에도 초기화, 종료 메소드 적용 가능



destroyMethod의 default 는 (inferred) -> close, shutdown의 메소드를 이건가보다 하고 추측해서 호출해줌.

이름만 잘 정했으면 따로 destroyMethod를 지정하지 않아도 잘 동작함.

이거 쓰기 싫으면 destroyMethod = ""



#### 어노테이션 @PostConstruct, @PreDestroy

그냥 시작에 @PostConstruct, 종료에 @PreDestroy 넣기

> 얘네는 javax.annotation -> 자바에서 공식으로 지원, 스프링 아니어도 잘 됨.

@Component랑 잘 어울림

이때 외부 라이브러리에서는 적용하지 못함.