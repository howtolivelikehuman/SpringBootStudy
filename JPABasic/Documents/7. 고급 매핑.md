## 7. 고급 매핑

#### 상속관계 매핑

원래 관계형 데이터베이스는 상속 관계 X (그나마 비슷한건 슈퍼타입-서브타입 관계)

-> 객체 상속처럼 DB의 슈퍼타입-서브타입 관계 매핑



1. 각각 테이블로 변환 -> 이후 Join

   > 부모에 구분하는 컬럼
   >
   > 자식에는 PK이자 FK

2. 단일 테이블 

   > 하나에 다때려박고, 구분하는 컬럼

3. 그냥 아예 상관없이 테이블 세개로 만들기

   > 중복되는 속성 다 들고있기



전략 설정

* @Inheritance (startegy = InheritanceType.xx)

  JOINED = 조인 전략

  SINGLE_TABLE  = 단일 테이블 (Default)

  TABLE_PER_CLASS = 각각 테이블



DTYPE 설정

* @DiscriminatorColumn (name = "구분하는 컬럼")

* @DiscriminatorValue ("구분 값은 이걸로 넣어라")

  -> 단일테이블에서는 DTYPE 필수 (없으면 구분을 못함)

  -> JOIN에서는 설정 안하면 안 만들어짐



근데, 어떤 식으로 하던 객체 입장에서는 똑같음 (객체는 그냥 상속관계)

테이블을 조인전략으로하나, 단일테이블로하나 코드를 바꿀 필요는 X



각각 테이블로 만들때는, 부모클래스를 단독테이블로 사용하지 않을 것이므로 추상클래스로 만들기



장단점

JOIN (정석)

> 장점  : 테이블 정규화, 외래키 참조 무결성 조약, 저장공간 효율화
>
> 단점 : 조회시 join 많이 사용 (성능 저하), 조회 쿼리 복잡, insert 2번

단일 테이블

> 장점 : Join x = 조회 빠름, 단순
>
> 단점 : 컬럼이 많아짐 -> null이 많아짐, 테이블이 커서 오히려 성능 느려짐

각각 테이블 (아무도 안씀)

> DBA / ORM전문가 둘다 싫어함
>
> 묶이는게 없어서 너무 불편함
>
> 부모클래스로 조회시 UNION ALL로 모든 테이블 다 뒤져서 찾아야 함
>
> 그나마 장점은 서브 타입 명확하게 구분해서 처리가능 (나뉘어져있음), not null 자유로움



