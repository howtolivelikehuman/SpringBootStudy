## 다양한 연관관계 매핑

* 애매할때는 반대쪽을 생각해보기

  1:N의 반대는 N:1임

  > 양방향은 사실 단방향이 두개있는거임

  연관관계의 주인 : 외래 키를 관리하는 참조



* 일대다 단방향

  권장 X  -> 다른 테이블을 내가 건드려야함.

  다대일에서 필요하면 양방향으로 하는 형태 선호

  > 객체지향적으로는 손해지만, DB적으로 쿼리, 헷갈릴 일이 적음

  @JoinColumn 사용

  > 안쓰면 조인 테이블 사용 (다대다에서쓰는거) -> 성능 하락

  

* 일대다 양방향

  스펙상은 X, 

  @ManyToOne + @JoinColumn (insertable = false, updateable = false)

  > 읽기전용필드로 양방향처럼

  

* 일대일

  주 테이블에 외래키 - 대상에 외래키 (DB에서는 외래키에 unique 추가)

  다대일 단방향과 유사 (주인은 JoinColumn - 반대는 MappedBy)

  > 단방향 관계는 JPA 지원 X
  >
  > 내 엔티티의 외래키를 내가 직접 관리

  <고뇌>

  사람 - 로커의 경우 외래키를 어디다 둘 것인가

  > DBA : 미래에 사람이 로커 여러개를 가질 수 있는 경우
  >
  >  -> 로커에 사람의 외래키가 있으면 쉬움. 그냥 제약만 바꿔서 추가하면됨 (반대는 머리아픔)
  >
  > 
  >
  > 개발자 : 사람에 로커가 있는게 성능상 유리
  >
  > -> 사람한테 로커가 있냐 없냐 확인하기 편함 (null이냐?)

  

  [주 테이블에 외래 키]

  객체지향 개발자 선호. JPA 매핑 편리

  장점 : 테이블만 조회해도 데이터 있는지 확인 가능

  단점 : NULL이 생김

  

  [대상 테이블에 외래 키]

  DB개발자 선호

  장점 : 일대다 관계가 되면 DB 확장 편리

  단점 : 지연 로딩으로 설정해도 항상 즉시 로딩이 됨 (어차피 쿼리가 나감)

  

* 다대다

  RDBMS에서는 다대다가 안됨 -> 연결테이블을 써야함

  근데 객체는 다대다가됨

  @ManyToMany + @JoinTable

  하지만 실무에서 힘듦 (너무 복잡)

  > OneToMany - ManyToOne으로 연결테이블을 구현하자.

