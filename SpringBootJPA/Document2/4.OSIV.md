## 4.OSIV

Open Session In View : 하이버네이트 - > Open EntityManager In View : JPA

(spring.jpa.open-in-view : true가 default)



* JPA가 DB 커넥션을 가져오는 시점

  -> 간단하게는 트랜잭션을 시작할 때 영속성 컨텍스트가 가져와서 유지

* DB커넥션을 반환하는 시점 (OSIV가 켜져있으면)

  -> @Transaction 이후까지 유지 ->왜냐면 지연 로딩을 하기 위해



근데 이러면 커넥션 리소스를 너무 오래 사용 (Response까지 극한으로 가지고 있음)

실시간 트래픽이 중요하면 커넥션이 모자라게 됨



* OSIV 끄면

  트랜잭션 종료 시 영속성 컨텍스트 닫음 -> 데이터베이스 커넥션 반환

  자기 할 메소드하고 반환하니깐 낭비 안함

  -> 근데 이럼 지연 로딩을 트랜잭션 안에서 처리해야 함. (컨트롤러 / 뷰에서 처리 불가능)



해결) 쿼리형 서비스를 만들기 (화면용)

-> 여기 안에다가 트랜잭션 설정 후 여기서 변환로직

복잡한 화면 출력용 쿼리 -> 화면에 맞춰서 최적화.

근데 핵심 비즈니스에 영향을 주지는 않음 -> **분리해서 만들기.**

> 화면용 api는 자주 바뀜 <-> 핵심 비즈니스 로직은 변경 x



OSIV 키면 편함. 하지만 성능 이슈 있을 때는 끄고 가기

